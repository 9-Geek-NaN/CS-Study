# TCP/IP encapsulation

![osi_model](https://github.com/user-attachments/assets/9bc2156a-b349-4ef7-974e-30804f9c460e)

## **OSI 7 계층**

각 계층은 네트워크 통신의 특정 기능을 담당하며, 데이터를 송신 또는 수신할 때 계층적으로 처리합니다

1. **응용 계층(Application Layer)**: 사용자가 접하는 서비스 (예: HTTP, FTP, SMTP 등)
2. **표현 계층(Presentation Layer)**: 데이터의 형식 변환 및 암호화 (예: JPEG, MPEG)
3. **세션 계층(Session Layer)**: 통신 세션 관리 (예: RPC, 소켓)
4. **전송 계층(Transport Layer)**: 데이터의 신뢰성과 흐름 제어 (예: TCP, UDP)
5. **네트워크 계층(Network Layer)**: 데이터 라우팅 및 주소 지정 (예: IP)
6. **데이터 링크 계층(Data Link Layer)**: 물리적 연결 설정 및 오류 탐지 (예: MAC 주소)
7. **물리 계층(Physical Layer)**: 비트 단위 전송 (예: 케이블, 무선)

### **OSI 모델이 필요한 이유**

- 계층 간 독립성: 각 계층은 독립적으로 설계됨, 그래서 수정 시 다른 계층에 영향을 주지 않습니다
- 표준화: 모든 장치와 소프트웨어가 동일한 규칙에 따라 통신 가능합니다
- 문제 해결 용이성: 네트워크 문제를 특정 계층에서 쉽게 진단이 가능하겠지요

## **Encapsulation**

데이터가 송신될 때, 상위 계층에서 하위 계층으로 이동하면서 각 계층이 헤더를 추가합니다

### **캡슐화 과정**

1. 응용 계층: 사용자 데이터를 HTTP 프로토콜과 같은 형식으로 캡슐화
    - 소포를 준비 - 편지를 쓰거나 물건(데이터)을 준비
    - 예: HTTP Header + Data
2. 전송 계층: TCP/UDP 헤더를 추가하여 데이터의 신뢰성과 순서를 보장
    - 택배 상자에 송장(출발지/목적지 정보, 물품 목록 등)을 붙힘
    - TCP 헤더에 포함: 출발지/목적지 포트 번호, 순서 번호 등
3. 네트워크 계층: IP 헤더를 추가하여 데이터가 목적지까지 전달되도록 라우팅
    - 택배 회사가 어떤 경로(도로, 항공, 배)를 통해 물건을 보낼지 계획함
    - IP 헤더에 포함: 출발지/목적지 IP 주소
4. 데이터 링크 계층: MAC 헤더를 추가하여 물리적 네트워크 장치 간 데이터를 전송
    - 포장된 택배 상자를 트럭에 싣고 물리적으로 이동할 준비함
    - MAC 헤더에 포함: 출발지/목적지 MAC 주소
5. 물리 계층: 데이터를 bit 단위로 변환해 전송
    - 택배가 트럭을 타고 목적지로 이동함

## **Decapsulation**

캡슐화와 반대의 과정을 통해 데이터를 해독하는 과정

### **디캡슐화 과정**

1. 물리 계층에서 비트를 읽어들이고 프레임으로 변환
    - 택배 아저씨가 집 앞까지 상자를 가져옴
2. 데이터 링크 계층에서 MAC 헤더를 제거하고 IP 데이터그램 추출
    - 택배 상자를 확인하고 집 안으로 가져옴
3. 네트워크 계층에서 IP 헤더를 제거하고 TCP 세그먼트 추출
    - 택배 상자에서 송장을 떼고 필요한 정보를 확인
4. 전송 계층에서 TCP 헤더를 제거하여 HTTP 데이터를 확보
    - 상자를 열고 포장된 물건(데이터)을 꺼냄
5. 응용 계층에서 HTTP 데이터를 처리하여 최종 데이터 복원
    - 데이터를 최종적으로 사용

## **이런 복잡한 과정을 왜 거쳐야함?**

1. 안전한 전송: 여러 계층이 데이터를 보호하고 손실을 막아줌
    - 예: 상자가 튼튼하고 송장이 정확하면 잃어버리지 않음
2. 효율적인 처리: 각 계층이 자기 역할만 집중해서 수행
    - 예: 택배 아저씨는 운전만 하고, 포장은 우리가 함
3. 호환성: 모든 시스템이 동일한 규칙(택배 회사의 규정)을 따르기 때문에 누구와도 통신 가능
    - 예: 전국 어디든 택배 보낼 수 있음.