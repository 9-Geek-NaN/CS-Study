# CAP theorem

![cap_theorem](https://github.com/user-attachments/assets/d8c4409d-2739-4b9c-b271-7edfe898676f)

## **CAP의 3가지 요소**

### **1 - Consistency (일관성)**

모든 노드가 같은 시점에 동일한 데이터를 볼 수 있어야함

데이터 변경이 발생하면 즉시 모든 노드에 적용되어야함

예시) 은행 계좌의 잔액이 여러 데이터베이스 노드에 저장되어 있다고 가정하면, 어느 노드에서 조회해도 동일한 잔액이 나와야함

### **2 - Availability (가용성)**

모든 요청이 항상 응답을 받을 수 있어야 함(성공/실패 여부와 상관없이!)

일부 노드가 실패하더라도 시스템이 계속 작동해야함

예시) 사용자가 온라인 쇼핑몰에서 상품 목록을 요청할 때 서버가 다운되더라도 다른 서버가 즉시 응답해야함

### **3 - Partition Tolerance (파티션 허용성)**

네트워크 분할(Partition)이 발생해도 시스템이 작동을 멈추지 않고 계속 운영 가능해야함

노드 간 통신이 끊겨도 각 노드는 독립적으로 동작해야함

예시) 두 데이터센터가 네트워크 문제로 연결되지 않더라도, 각 데이터센터는 독립적으로 사용자의 요청을 처리해야함

## **CAP의 핵심: “셋 중 둘만 선택 가능”**

> CA, CP, AP중에 고르세요 세가지 모두 다는 못 가져갑니다~ 허허 😛
> 

### **CA**

일관성과 가용성을 선택!

네트워크 분할을 허용하지 않음

모든 데이터는 항상 일관성을 유지하고, 모든 요청은 어떤 상황에서도 응답함

사용 사례: 단일 노드 DBMS(MySQL, Oracle) 같은 시스템

적합한 경우: 네트워크 분할이 거의 발생하지 않는 단일 서버 시스템

### **CP**

일관성과 파티션 허용성을 선택!

일부 요청이 실패할 수 있지만 데이터는 항상 일관성을 유지함

사용 사례: 금융 시스템, Zookeeper, BigTable

적합한 경우: 일관성이 매우 중요한 시스템 → 은행이나 결제 시스템이 있겠지요~

### **AP**

가용성과 파티션 허용성을 선택!

데이터 일관성이 낮을 수 있지만 요청은 항상 응답함

사용 사례: NoSQL 시스템(Cassandra, CouchDB)

적합한 경우: 빠른 응답이 중요한 시스템 → SNS, 실시간 채팅이 있겠지요~

## **CAP의 실체**

1. 모든 상황에서 CAP를 선택 기준으로 사용할 수 없습니다!
    1. 분산 시스템 설계에는 CAP 이론 외에도 데이터 특성, 응답 시간, 확장성을 고려해야함
2. 네트워크 분할은 흔하지 않지만 대비가 항상 필요함
    1. 네트워크 분할이 발생하면 큰 영향을 미칠 수 있어서 대부분의 분산 시스템은 Partition Tolerance를 우선 고려한다고 합니다
3. 완벽한 가용성과 일관성은 없다!
    1. 100% 가용성과 일관선을 동시에 달성하려는 시도는 현실적이지 않답니다

## **“100% 가용성과 일관선을 동시에 달성하려는 시도는 현실적이지 않답니다” → WHY?** 😳

일단 가용성과 일관성에 대해서 다시 봅시다.

> 1 - Availability (가용성)
> 
> 
> 네트워크 분할 상황에서도 모든 노드는 요청에 대해 응답해야 한다는 특성
> 
> 즉, 어떤 노드든 사용자의 요청을 처리하고 결과를 반환해야 합니다
> 
> 예시) 네트워크가 끊겨도 A 노드와 B 노드 각각에서 데이터를 처리하고 응답할 수 있어야함
> 
> 2 - Consistency (일관성)
> 
> 모든 노드가 같은 데이터를 유지하고, 모든 요청에 대해 동일한 결과를 반환해야 한다는 특성
> 
> 즉, 분할된 노드들이 서로 다른 데이터를 반환하면 안 됩니다
> 
> 예시) A에서 업데이트된 데이터가 B에서도 동일하게 반영되어야함
> 

### **문제의 본질**

네트워크 분할이 발생하면 시스템은 두 가지 중 하나를 선택해야함

1. 가용성 우선
    1. A와 B가 독립적으로 데이터를 처리하고 응답함
    2. 이 경우, A와 B의 데이터가 일치하지 않을 수 있겠지요? 그럼 일관성이 깨집니다
2. 일관성 우선
    1. A와 B는 네트워크 연결이 복구될 때까지 데이터 처리 및 응답을 중단함
    2. 이 경우, 시스템은 요청에 응답하지 않으므로 가용성이 깨지네요?

이러한 이유로 동시에 달성하려는 시도는 현실적으로 어렵습니다~

## **결론**

**CAP 이론은 설계의 절대적인 기준이 아니라 참고용 도구로 사용해야함**